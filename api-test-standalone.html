<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIçµ±åˆãƒ†ã‚¹ãƒˆ (Standalone) - AI AutoForm</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-white mb-8">ğŸ”Œ APIçµ±åˆãƒ†ã‚¹ãƒˆ (Standalone)</h1>
        
        <!-- API Status -->
        <div id="api-status" class="bg-slate-800 border border-slate-700 rounded-lg p-4 mb-8">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-yellow-500 animate-pulse"></div>
                <span>APIæ¥ç¶šç¢ºèªä¸­...</span>
            </div>
        </div>

        <!-- Test Sections -->
        <div class="grid grid-cols-2 gap-6">
            <!-- Workers API -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ‘¥ Workers API</h2>
                <div class="space-y-3">
                    <button onclick="testWorkers()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/workers
                    </button>
                    <button onclick="createSampleWorker()" class="w-full bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold">
                        POST /api/workers
                    </button>
                    <pre id="workers-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>

            <!-- Products API -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ“¦ Products API</h2>
                <div class="space-y-3">
                    <button onclick="testProducts()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/products
                    </button>
                    <button onclick="createSampleProduct()" class="w-full bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold">
                        POST /api/products
                    </button>
                    <pre id="products-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>

            <!-- Target Lists API -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ¯ Target Lists API</h2>
                <div class="space-y-3">
                    <button onclick="testTargetLists()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/targets/lists
                    </button>
                    <button onclick="createSampleTargetList()" class="w-full bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold">
                        POST /api/targets/lists
                    </button>
                    <pre id="targetlists-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>

            <!-- Projects API -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ“‹ Projects API</h2>
                <div class="space-y-3">
                    <button onclick="testProjects()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/projects
                    </button>
                    <button onclick="testProjectStats()" class="w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/projects/1/stats
                    </button>
                    <pre id="projects-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>

            <!-- Tasks API -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">âœ… Tasks API</h2>
                <div class="space-y-3">
                    <button onclick="testTasks()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/tasks
                    </button>
                    <button onclick="testTasksByWorker()" class="w-full bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold">
                        GET /api/tasks?worker_id=1
                    </button>
                    <pre id="tasks-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>

            <!-- All Data Summary -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼</h2>
                <div class="space-y-3">
                    <button onclick="fetchAllData()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white px-4 py-2 rounded font-bold">
                        å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—
                    </button>
                    <pre id="summary-result" class="bg-slate-900 rounded p-3 text-xs overflow-auto max-h-40"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç‰ˆ)
        // GitHub Codespaceså¯¾å¿œ: ç¾åœ¨ã®ãƒ›ã‚¹ãƒˆã‹ã‚‰APIã®URLã‚’æ¨æ¸¬
        let API_BASE_URL;
        const currentHost = window.location.host;
        if (currentHost.includes('app.github.dev')) {
            // Codespacesã®å ´åˆ: ãƒãƒ¼ãƒˆç•ªå·ã‚’8000ã‹ã‚‰5001ã«å¤‰æ›´
            API_BASE_URL = window.location.protocol + '//' + currentHost.replace('-8000.', '-5001.') + '/api';
        } else {
            // ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®å ´åˆ
            API_BASE_URL = 'http://localhost:5001/api';
        }
        console.log('ğŸ”— API Base URL:', API_BASE_URL);

        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«APIæ¥ç¶šç¢ºèª
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const healthUrl = API_BASE_URL.replace('/api', '') + '/api/health';
                console.log('ğŸ¥ Health Check URL:', healthUrl);
                const response = await fetch(healthUrl);
                const data = await response.json();
                
                document.getElementById('api-status').innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <span class="font-bold">APIæ¥ç¶šæˆåŠŸ</span>
                        <span class="text-slate-400 text-sm ml-auto">${data.version || 'N/A'} | ${data.database || 'N/A'}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('api-status').innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <span class="font-bold text-red-400">APIæ¥ç¶šå¤±æ•—</span>
                        <span class="text-slate-400 text-sm ml-auto">${error.message}</span>
                    </div>
                `;
            }
        });

        // Workers API Tests
        async function testWorkers() {
            try {
                const workers = await apiRequest('/workers');
                document.getElementById('workers-result').textContent = JSON.stringify(workers, null, 2);
            } catch (error) {
                document.getElementById('workers-result').textContent = `Error: ${error.message}`;
            }
        }

        async function createSampleWorker() {
            try {
                const worker = await apiRequest('/workers', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                        email: `test${Date.now()}@example.com`,
                        skill_level: 'intermediate'
                    })
                });
                document.getElementById('workers-result').textContent = JSON.stringify(worker, null, 2);
                alert('âœ… ãƒ¯ãƒ¼ã‚«ãƒ¼ä½œæˆæˆåŠŸ!');
            } catch (error) {
                document.getElementById('workers-result').textContent = `Error: ${error.message}`;
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // Products API Tests
        async function testProducts() {
            try {
                const products = await apiRequest('/products');
                document.getElementById('products-result').textContent = JSON.stringify(products, null, 2);
            } catch (error) {
                document.getElementById('products-result').textContent = `Error: ${error.message}`;
            }
        }

        async function createSampleProduct() {
            try {
                const product = await apiRequest('/products', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: 'ãƒ†ã‚¹ãƒˆå•†æ',
                        price: 100000,
                        description: 'APIçµ±åˆãƒ†ã‚¹ãƒˆç”¨ã®å•†æ'
                    })
                });
                document.getElementById('products-result').textContent = JSON.stringify(product, null, 2);
                alert('âœ… å•†å“ä½œæˆæˆåŠŸ!');
            } catch (error) {
                document.getElementById('products-result').textContent = `Error: ${error.message}`;
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // Target Lists API Tests
        async function testTargetLists() {
            try {
                const lists = await apiRequest('/targets/lists');
                document.getElementById('targetlists-result').textContent = JSON.stringify(lists, null, 2);
            } catch (error) {
                document.getElementById('targetlists-result').textContent = `Error: ${error.message}`;
            }
        }

        async function createSampleTargetList() {
            try {
                const list = await apiRequest('/targets/lists', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: `ãƒ†ã‚¹ãƒˆãƒªã‚¹ãƒˆ ${new Date().toLocaleString('ja-JP')}`
                    })
                });
                document.getElementById('targetlists-result').textContent = JSON.stringify(list, null, 2);
                alert('âœ… ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆä½œæˆæˆåŠŸ!');
            } catch (error) {
                document.getElementById('targetlists-result').textContent = `Error: ${error.message}`;
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // Projects API Tests
        async function testProjects() {
            try {
                const projects = await apiRequest('/projects');
                document.getElementById('projects-result').textContent = JSON.stringify(projects, null, 2);
            } catch (error) {
                document.getElementById('projects-result').textContent = `Error: ${error.message}`;
            }
        }

        async function testProjectStats() {
            try {
                const stats = await apiRequest('/projects/1/stats');
                document.getElementById('projects-result').textContent = JSON.stringify(stats, null, 2);
            } catch (error) {
                document.getElementById('projects-result').textContent = `Error: ${error.message}`;
            }
        }

        // Tasks API Tests
        async function testTasks() {
            try {
                const tasks = await apiRequest('/tasks');
                document.getElementById('tasks-result').textContent = JSON.stringify(tasks, null, 2);
            } catch (error) {
                document.getElementById('tasks-result').textContent = `Error: ${error.message}`;
            }
        }

        async function testTasksByWorker() {
            try {
                const tasks = await apiRequest('/tasks?worker_id=1');
                document.getElementById('tasks-result').textContent = JSON.stringify(tasks, null, 2);
            } catch (error) {
                document.getElementById('tasks-result').textContent = `Error: ${error.message}`;
            }
        }

        // All Data Summary
        async function fetchAllData() {
            try {
                const [workers, products, lists, projects, tasks] = await Promise.all([
                    apiRequest('/workers'),
                    apiRequest('/products'),
                    apiRequest('/targets/lists'),
                    apiRequest('/projects'),
                    apiRequest('/tasks')
                ]);

                const summary = {
                    workers: { count: workers.length, data: workers },
                    products: { count: products.length, data: products },
                    target_lists: { count: lists.length, data: lists },
                    projects: { count: projects.length, data: projects },
                    tasks: { count: tasks.length, data: tasks }
                };

                document.getElementById('summary-result').textContent = JSON.stringify(summary, null, 2);
            } catch (error) {
                document.getElementById('summary-result').textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
