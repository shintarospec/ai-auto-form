<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Console - AI AutoForm (APIç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .pulse-ring {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #6366f1;
            border-radius: 50%;
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { transform: scale(2); opacity: 0; }
        }
        .view-section { display: none; }
        .view-section.active { display: block; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 h-screen flex overflow-hidden">

    <!-- Admin Sidebar -->
    <aside class="w-64 bg-slate-950 border-r border-slate-800 flex flex-col z-20">
        <div class="h-16 flex items-center px-6 border-b border-slate-800">
            <i class="fa-solid fa-layer-group text-indigo-500 text-xl mr-3"></i>
            <span class="font-bold text-lg text-white tracking-wide">Admin Console</span>
        </div>
        
        <!-- API Status Indicator -->
        <div id="api-status" class="mx-3 mt-3 px-3 py-2 rounded-lg bg-slate-800 border border-slate-700">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
                <span class="text-xs text-slate-400">APIæ¥ç¶šä¸­...</span>
            </div>
        </div>

        <nav class="flex-1 py-6 space-y-1 px-3">
            <p class="px-3 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Management</p>
            
            <button onclick="switchView('overview')" id="nav-overview" class="nav-btn w-full flex items-center px-4 py-3 rounded-lg bg-indigo-600 text-white shadow-lg shadow-indigo-900/50 transition-all">
                <i class="fa-solid fa-chart-line w-6"></i>
                <span class="font-medium">å…¨ä½“ã‚µãƒãƒªãƒ¼</span>
            </button>
            
            <button onclick="switchView('projects')" id="nav-projects" class="nav-btn w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i class="fa-solid fa-diagram-project w-6"></i>
                <span class="font-medium">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†</span>
            </button>

            <p class="px-3 text-xs font-bold text-slate-500 uppercase tracking-wider mt-6 mb-2">Databases</p>
            
            <button onclick="switchView('db-company')" id="nav-db-company" class="nav-btn w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i class="fa-solid fa-building w-6"></i>
                <span class="font-medium">ä¼æ¥­ãƒªã‚¹ãƒˆDB</span>
            </button>
            
            <button onclick="switchView('db-product')" id="nav-db-product" class="nav-btn w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i class="fa-solid fa-briefcase w-6"></i>
                <span class="font-medium">æ¡ˆä»¶ãƒ»å•†æDB</span>
            </button>

            <button onclick="switchView('db-worker')" id="nav-db-worker" class="nav-btn w-full flex items-center px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i class="fa-solid fa-users w-6"></i>
                <span class="font-medium">ä½œæ¥­è€…DB</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800 text-xs text-slate-500 text-center">
            v3.0.0 (APIçµ±åˆç‰ˆ)
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-900">
        
        <!-- Header -->
        <header class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-8 z-10">
            <h2 id="page-title" class="text-xl font-bold text-white">å…¨ä½“ã‚µãƒãƒªãƒ¼</h2>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-800 rounded-full border border-slate-700">
                    <div id="system-status-dot" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span id="system-status-text" class="text-xs font-medium text-slate-300">System Healthy</span>
                </div>
                <button onclick="refreshCurrentView()" class="w-8 h-8 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 transition">
                    <i class="fa-solid fa-rotate"></i>
                </button>
            </div>
        </header>

        <!-- VIEW 1: Overview Dashboard -->
        <div id="view-overview" class="view-section active flex-1 overflow-y-auto p-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">ç·ã‚¿ã‚¹ã‚¯æ•°</p>
                    <div class="flex items-end gap-3">
                        <span class="text-3xl font-bold text-white" id="overview-total-tasks">0</span>
                    </div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">å®Œäº†ã‚¿ã‚¹ã‚¯</p>
                    <div class="flex items-end gap-3">
                        <span class="text-3xl font-bold text-green-400" id="overview-completed-tasks">0</span>
                    </div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
                    <div class="flex items-end gap-3">
                        <span class="text-3xl font-bold text-indigo-400" id="overview-active-projects">0</span>
                    </div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">ç™»éŒ²ä½œæ¥­è€…</p>
                    <div class="flex items-end gap-3">
                        <span class="text-3xl font-bold text-yellow-400" id="overview-total-workers">0</span>
                        <span class="text-sm text-slate-500 mb-1">å</span>
                    </div>
                </div>
            </div>

            <!-- Recent Projects & Workers -->
            <div class="grid grid-cols-2 gap-6">
                <!-- Recent Projects -->
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <h3 class="font-bold text-slate-200 mb-4">æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h3>
                    <div id="recent-projects" class="space-y-3">
                        <p class="text-slate-500 text-sm">èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>

                <!-- Top Workers -->
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
                    <h3 class="font-bold text-slate-200 mb-4">ãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
                    <div id="top-workers" class="space-y-3">
                        <p class="text-slate-500 text-sm">èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: Projects Management -->
        <div id="view-projects" class="view-section flex-1 overflow-y-auto p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†</h3>
                <button onclick="showCreateProjectModal()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition shadow-lg shadow-indigo-900/50">
                    <i class="fa-solid fa-plus mr-2"></i>æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
                </button>
            </div>

            <div id="projects-list" class="space-y-4">
                <p class="text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <!-- VIEW 3: Company Database -->
        <div id="view-db-company" class="view-section flex-1 overflow-y-auto p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">ä¼æ¥­ãƒªã‚¹ãƒˆDB</h3>
                <button onclick="showCreateTargetListModal()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    <i class="fa-solid fa-plus mr-2"></i>æ–°è¦ãƒªã‚¹ãƒˆä½œæˆ
                </button>
            </div>

            <div id="target-lists" class="space-y-4">
                <p class="text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <!-- VIEW 4: Product Database -->
        <div id="view-db-product" class="view-section flex-1 overflow-y-auto p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">æ¡ˆä»¶ãƒ»å•†æDB</h3>
                <button onclick="showCreateProductModal()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    <i class="fa-solid fa-plus mr-2"></i>æ–°è¦å•†æç™»éŒ²
                </button>
            </div>

            <div id="products-list" class="space-y-4">
                <p class="text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <!-- VIEW 5: Worker Database -->
        <div id="view-db-worker" class="view-section flex-1 overflow-y-auto p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">ä½œæ¥­è€…DB</h3>
                <button onclick="showCreateWorkerModal()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    <i class="fa-solid fa-plus mr-2"></i>æ–°è¦ä½œæ¥­è€…ç™»éŒ²
                </button>
            </div>

            <div id="workers-list" class="space-y-4">
                <p class="text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

    </main>

    <!-- Create Project Modal -->
    <div id="create-project-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-8 w-full max-w-2xl border border-slate-700">
            <h3 class="text-2xl font-bold text-white mb-6">æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</label>
                    <input id="project-name" type="text" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="ä¾‹: ITä¼æ¥­å‘ã‘AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå–¶æ¥­">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆ</label>
                    <select id="project-target-list" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">å•†æ</label>
                    <select id="project-product" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">æ‹…å½“ä½œæ¥­è€…ã‚’é¸æŠ (è¤‡æ•°é¸æŠå¯)</label>
                    <div id="project-workers" class="max-h-48 overflow-y-auto bg-slate-900 border border-slate-700 rounded-lg p-4 space-y-2">
                        <!-- Worker checkboxes will be populated here -->
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="closeCreateProjectModal()" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="createProject()" class="flex-1 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    ä½œæˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Create Target List Modal -->
    <div id="create-target-list-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-8 w-full max-w-2xl border border-slate-700">
            <h3 class="text-2xl font-bold text-white mb-6">æ–°è¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆä½œæˆ</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ãƒªã‚¹ãƒˆå</label>
                    <input id="target-list-name" type="text" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="ä¾‹: æ±äº¬ITä¼æ¥­ãƒªã‚¹ãƒˆ">
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="closeCreateTargetListModal()" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="createTargetList()" class="flex-1 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    ä½œæˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Create Product Modal -->
    <div id="create-product-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-8 w-full max-w-2xl border border-slate-700">
            <h3 class="text-2xl font-bold text-white mb-6">æ–°è¦å•†æç™»éŒ²</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">å•†æå</label>
                    <input id="product-name" type="text" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="ä¾‹: AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå°å…¥">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ä¾¡æ ¼ (å††)</label>
                    <input id="product-price" type="number" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="500000">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">èª¬æ˜</label>
                    <textarea id="product-description" rows="3" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="å•†æã®è©³ç´°èª¬æ˜"></textarea>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="closeCreateProductModal()" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="createProduct()" class="flex-1 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    ç™»éŒ²
                </button>
            </div>
        </div>
    </div>

    <!-- Create Worker Modal -->
    <div id="create-worker-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-8 w-full max-w-2xl border border-slate-700">
            <h3 class="text-2xl font-bold text-white mb-6">æ–°è¦ä½œæ¥­è€…ç™»éŒ²</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">åå‰</label>
                    <input id="worker-name" type="text" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="å±±ç”°å¤ªéƒ">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input id="worker-email" type="email" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none" placeholder="yamada@example.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«</label>
                    <select id="worker-skill-level" class="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:border-indigo-500 focus:outline-none">
                        <option value="beginner">åˆç´š (Beginner)</option>
                        <option value="intermediate">ä¸­ç´š (Intermediate)</option>
                        <option value="advanced">ä¸Šç´š (Advanced)</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="closeCreateWorkerModal()" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="createWorker()" class="flex-1 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition">
                    ç™»éŒ²
                </button>
            </div>
        </div>
    </div>

    <script src="frontend/js/api.js"></script>
    <script>
        // Global State
        let allWorkers = [];
        let allProducts = [];
        let allTargetLists = [];
        let allProjects = [];

        // API Status Check
        async function checkAPIStatus() {
            try {
                const response = await fetch(API_BASE_URL + '/health');
                const health = await response.json();
                document.getElementById('api-status').innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        <span class="text-xs text-slate-400">APIæ¥ç¶šå®Œäº†</span>
                    </div>
                `;
                document.getElementById('system-status-dot').className = 'w-2 h-2 rounded-full bg-green-500';
                document.getElementById('system-status-text').textContent = 'API Connected';
            } catch (error) {
                console.error('APIæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('api-status').innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-red-500"></div>
                        <span class="text-xs text-red-400">APIæ¥ç¶šå¤±æ•—</span>
                    </div>
                `;
                document.getElementById('system-status-dot').className = 'w-2 h-2 rounded-full bg-red-500';
                document.getElementById('system-status-text').textContent = 'API Error';
            }
        }

        // View Switching
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            // Show selected view
            document.getElementById(`view-${viewName}`).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/50');
                btn.classList.add('text-slate-400');
            });
            document.getElementById(`nav-${viewName}`).classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/50');
            document.getElementById(`nav-${viewName}`).classList.remove('text-slate-400');

            // Update page title
            const titles = {
                'overview': 'å…¨ä½“ã‚µãƒãƒªãƒ¼',
                'projects': 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†',
                'db-company': 'ä¼æ¥­ãƒªã‚¹ãƒˆDB',
                'db-product': 'æ¡ˆä»¶ãƒ»å•†æDB',
                'db-worker': 'ä½œæ¥­è€…DB'
            };
            document.getElementById('page-title').textContent = titles[viewName];

            // Load data for the view
            loadViewData(viewName);
        }

        // Load data for current view
        async function loadViewData(viewName) {
            try {
                switch (viewName) {
                    case 'overview':
                        await renderOverview();
                        break;
                    case 'projects':
                        await renderProjects();
                        break;
                    case 'db-company':
                        await renderCompanyDB();
                        break;
                    case 'db-product':
                        await renderProductDB();
                        break;
                    case 'db-worker':
                        await renderWorkerDB();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${viewName}:`, error);
            }
        }

        // Render Overview
        async function renderOverview() {
            try {
                const [projects, workers, tasks] = await Promise.all([
                    API.Projects.getAll(),
                    API.Workers.getAll(),
                    API.Tasks.getAll()
                ]);

                // Update stats
                document.getElementById('overview-total-tasks').textContent = tasks.length;
                document.getElementById('overview-completed-tasks').textContent = tasks.filter(t => t.status === 'success').length;
                document.getElementById('overview-active-projects').textContent = projects.length;
                document.getElementById('overview-total-workers').textContent = workers.length;

                // Recent projects
                const recentProjects = projects.slice(0, 5);
                document.getElementById('recent-projects').innerHTML = recentProjects.length > 0 
                    ? recentProjects.map(p => `
                        <div class="flex items-center justify-between p-3 bg-slate-900 rounded-lg">
                            <span class="text-white font-medium">${p.name}</span>
                            <span class="text-xs text-slate-500">${p.task_count}ã‚¿ã‚¹ã‚¯</span>
                        </div>
                    `).join('')
                    : '<p class="text-slate-500 text-sm">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';

                // Top workers by points
                const topWorkers = workers.sort((a, b) => b.points - a.points).slice(0, 5);
                document.getElementById('top-workers').innerHTML = topWorkers.map((w, i) => `
                    <div class="flex items-center justify-between p-3 bg-slate-900 rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : 'ğŸ‘¤'}</span>
                            <span class="text-white font-medium">${w.name}</span>
                        </div>
                        <span class="text-yellow-400 font-bold">${w.points}pt</span>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Overview render error:', error);
            }
        }

        // Render Projects
        async function renderProjects() {
            try {
                const projects = await API.Projects.getAll();
                allProjects = projects;

                if (projects.length === 0) {
                    document.getElementById('projects-list').innerHTML = `
                        <div class="text-center py-12">
                            <i class="fa-solid fa-diagram-project text-6xl text-slate-700 mb-4"></i>
                            <p class="text-slate-400">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <p class="text-slate-600 text-sm mt-2">ã€Œæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                        </div>
                    `;
                    return;
                }

                document.getElementById('projects-list').innerHTML = projects.map(p => `
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h4 class="text-xl font-bold text-white mb-2">${p.name}</h4>
                                <div class="flex gap-3 text-sm">
                                    <span class="text-slate-400">
                                        <i class="fa-solid fa-list mr-1"></i>${p.target_list?.name || 'ãªã—'}
                                    </span>
                                    <span class="text-slate-400">
                                        <i class="fa-solid fa-box mr-1"></i>${p.product?.name || 'ãªã—'}
                                    </span>
                                </div>
                            </div>
                            <button onclick="viewProjectDetails(${p.id})" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm transition">
                                è©³ç´°
                            </button>
                        </div>
                        <div class="flex gap-4 text-sm">
                            <span class="text-green-400">
                                <i class="fa-solid fa-check-circle mr-1"></i>${p.task_count || 0} ã‚¿ã‚¹ã‚¯
                            </span>
                            <span class="text-yellow-400">
                                <i class="fa-solid fa-users mr-1"></i>${p.workers?.length || 0} ä½œæ¥­è€…
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Projects render error:', error);
                document.getElementById('projects-list').innerHTML = '<p class="text-red-400">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>';
            }
        }

        // Render Company DB
        async function renderCompanyDB() {
            try {
                const targetLists = await API.TargetLists.getAll();
                allTargetLists = targetLists;

                if (targetLists.length === 0) {
                    document.getElementById('target-lists').innerHTML = `
                        <div class="text-center py-12">
                            <i class="fa-solid fa-building text-6xl text-slate-700 mb-4"></i>
                            <p class="text-slate-400">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    `;
                    return;
                }

                document.getElementById('target-lists').innerHTML = targetLists.map(list => `
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-xl font-bold text-white">${list.name}</h4>
                            <span class="px-3 py-1 bg-indigo-600 text-white rounded-lg text-sm">
                                ${list.company_count || 0} ç¤¾
                            </span>
                        </div>
                        <button onclick="viewTargetListCompanies(${list.id})" class="text-indigo-400 hover:text-indigo-300 text-sm">
                            ä¼æ¥­ä¸€è¦§ã‚’è¦‹ã‚‹ â†’
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Company DB render error:', error);
            }
        }

        // Render Product DB
        async function renderProductDB() {
            try {
                const products = await API.Products.getAll();
                allProducts = products;

                if (products.length === 0) {
                    document.getElementById('products-list').innerHTML = `
                        <div class="text-center py-12">
                            <i class="fa-solid fa-briefcase text-6xl text-slate-700 mb-4"></i>
                            <p class="text-slate-400">å•†æãŒã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    `;
                    return;
                }

                document.getElementById('products-list').innerHTML = products.map(p => `
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-xl font-bold text-white">${p.name}</h4>
                            <span class="text-2xl font-bold text-green-400">Â¥${p.price.toLocaleString()}</span>
                        </div>
                        <p class="text-slate-400 text-sm">${p.description || 'èª¬æ˜ãªã—'}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Product DB render error:', error);
            }
        }

        // Render Worker DB
        async function renderWorkerDB() {
            try {
                const workers = await API.Workers.getAll();
                allWorkers = workers;

                if (workers.length === 0) {
                    document.getElementById('workers-list').innerHTML = `
                        <div class="text-center py-12">
                            <i class="fa-solid fa-users text-6xl text-slate-700 mb-4"></i>
                            <p class="text-slate-400">ä½œæ¥­è€…ãŒã„ã¾ã›ã‚“</p>
                        </div>
                    `;
                    return;
                }

                const skillBadges = {
                    'beginner': '<span class="px-2 py-1 bg-gray-600 text-white rounded text-xs">åˆç´š</span>',
                    'intermediate': '<span class="px-2 py-1 bg-blue-600 text-white rounded text-xs">ä¸­ç´š</span>',
                    'advanced': '<span class="px-2 py-1 bg-purple-600 text-white rounded text-xs">ä¸Šç´š</span>'
                };

                document.getElementById('workers-list').innerHTML = workers.map(w => `
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h4 class="text-xl font-bold text-white mb-2">${w.name}</h4>
                                <p class="text-slate-400 text-sm">${w.email}</p>
                            </div>
                            <div class="text-right">
                                ${skillBadges[w.skill_level] || ''}
                                <p class="text-yellow-400 font-bold mt-2">${w.points} pt</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Worker DB render error:', error);
            }
        }

        // Modal Functions
        function showCreateProjectModal() {
            // Populate dropdowns
            API.TargetLists.getAll().then(lists => {
                const select = document.getElementById('project-target-list');
                select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
                    lists.map(l => `<option value="${l.id}">${l.name}</option>`).join('');
            });

            API.Products.getAll().then(products => {
                const select = document.getElementById('project-product');
                select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
                    products.map(p => `<option value="${p.id}">${p.name} (Â¥${p.price.toLocaleString()})</option>`).join('');
            });

            API.Workers.getAll().then(workers => {
                const container = document.getElementById('project-workers');
                container.innerHTML = workers.map(w => `
                    <label class="flex items-center gap-2 cursor-pointer hover:bg-slate-800 p-2 rounded">
                        <input type="checkbox" value="${w.id}" class="worker-checkbox">
                        <span class="text-white">${w.name}</span>
                        <span class="text-slate-500 text-sm">(${w.skill_level})</span>
                    </label>
                `).join('');
            });

            document.getElementById('create-project-modal').classList.remove('hidden');
            document.getElementById('create-project-modal').classList.add('flex');
        }

        function closeCreateProjectModal() {
            document.getElementById('create-project-modal').classList.add('hidden');
            document.getElementById('create-project-modal').classList.remove('flex');
        }

        async function createProject() {
            const name = document.getElementById('project-name').value;
            const targetListId = document.getElementById('project-target-list').value;
            const productId = document.getElementById('project-product').value;
            const workerIds = Array.from(document.querySelectorAll('.worker-checkbox:checked')).map(cb => parseInt(cb.value));

            if (!name || !targetListId || !productId || workerIds.length === 0) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                await API.Projects.create({
                    name,
                    target_list_id: parseInt(targetListId),
                    product_id: parseInt(productId),
                    worker_ids: workerIds
                });
                closeCreateProjectModal();
                renderProjects();
                alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Project creation error:', error);
                alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showCreateTargetListModal() {
            document.getElementById('create-target-list-modal').classList.remove('hidden');
            document.getElementById('create-target-list-modal').classList.add('flex');
        }

        function closeCreateTargetListModal() {
            document.getElementById('create-target-list-modal').classList.add('hidden');
            document.getElementById('create-target-list-modal').classList.remove('flex');
        }

        async function createTargetList() {
            const name = document.getElementById('target-list-name').value;
            if (!name) {
                alert('ãƒªã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                await API.TargetLists.create({ name });
                closeCreateTargetListModal();
                renderCompanyDB();
                alert('ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Target list creation error:', error);
                alert('ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showCreateProductModal() {
            document.getElementById('create-product-modal').classList.remove('hidden');
            document.getElementById('create-product-modal').classList.add('flex');
        }

        function closeCreateProductModal() {
            document.getElementById('create-product-modal').classList.add('hidden');
            document.getElementById('create-product-modal').classList.remove('flex');
        }

        async function createProduct() {
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const description = document.getElementById('product-description').value;

            if (!name || !price) {
                alert('å•†æåã¨ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                await API.Products.create({
                    name,
                    price: parseInt(price),
                    description
                });
                closeCreateProductModal();
                renderProductDB();
                alert('å•†æã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Product creation error:', error);
                alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showCreateWorkerModal() {
            document.getElementById('create-worker-modal').classList.remove('hidden');
            document.getElementById('create-worker-modal').classList.add('flex');
        }

        function closeCreateWorkerModal() {
            document.getElementById('create-worker-modal').classList.add('hidden');
            document.getElementById('create-worker-modal').classList.remove('flex');
        }

        async function createWorker() {
            const name = document.getElementById('worker-name').value;
            const email = document.getElementById('worker-email').value;
            const skillLevel = document.getElementById('worker-skill-level').value;

            if (!name || !email) {
                alert('åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                await API.Workers.create({
                    name,
                    email,
                    skill_level: skillLevel
                });
                closeCreateWorkerModal();
                renderWorkerDB();
                alert('ä½œæ¥­è€…ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Worker creation error:', error);
                alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (error.message || ''));
            }
        }

        function refreshCurrentView() {
            const activeView = document.querySelector('.view-section.active');
            if (activeView) {
                const viewName = activeView.id.replace('view-', '');
                loadViewData(viewName);
            }
        }

        function viewProjectDetails(projectId) {
            alert(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID ${projectId} ã®è©³ç´°ç”»é¢ï¼ˆå®Ÿè£…äºˆå®šï¼‰`);
        }

        function viewTargetListCompanies(listId) {
            alert(`ãƒªã‚¹ãƒˆID ${listId} ã®ä¼æ¥­ä¸€è¦§ï¼ˆå®Ÿè£…äºˆå®šï¼‰`);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAPIStatus();
            await renderOverview();
        });
    </script>
</body>
</html>
